<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IronCity AttackSimPro - Purple Team Platform</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--gold:#D4AF37;--red:#DC143C;--dark:#0a0a14;--card:#1a1a2e;--purple:#9d4edd;--critical:#ff006e;--high:#ff4757;--medium:#ffa502;--low:#2ed573;--info:#54a0ff;--text:#fff;--muted:#a0a0b0;--border:#2a2a3e}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',sans-serif;background:var(--dark);color:var(--text);min-height:100vh}
.container{max-width:1400px;margin:0 auto;padding:0 20px}
.header{background:linear-gradient(135deg,#12121f,#1a1a2e);border-bottom:2px solid var(--gold);padding:20px 0}
.header-content{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:20px}
.logo-section{display:flex;align-items:center;gap:16px}
.logo{width:70px;height:70px;border-radius:12px;border:2px solid var(--gold)}
.brand h1{font-size:1.6rem;font-weight:700}
.brand .pro{color:var(--red)}
.brand .subtitle{color:var(--gold);font-size:.8rem;letter-spacing:2px;margin-top:4px}
.header-stats{display:flex;gap:24px}
.header-stat{text-align:center;padding:8px 16px;background:rgba(157,78,221,.1);border-radius:8px;border:1px solid var(--border)}
.header-stat-value{font-size:1.5rem;font-weight:700;color:var(--gold)}
.header-stat-label{font-size:.75rem;color:var(--muted);text-transform:uppercase}

/* AI Consensus Engine Banner */
.ai-engine-banner{background:linear-gradient(135deg,rgba(157,78,221,.15),rgba(212,175,55,.1));border:1px solid var(--purple);border-radius:16px;padding:24px;margin:24px 0}
.ai-engine-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:16px}
.ai-engine-title{font-size:1.4rem;color:var(--gold);display:flex;align-items:center;gap:12px}
.ai-engine-title svg{width:28px;height:28px}
.ai-engine-badge{background:linear-gradient(135deg,var(--purple),#7b2cbf);color:#fff;padding:8px 16px;border-radius:20px;font-size:.85rem;font-weight:600;display:flex;align-items:center;gap:8px}
.ai-engine-badge .pulse{width:8px;height:8px;background:#2ed573;border-radius:50%;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
.models-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px}
.model-card{background:rgba(0,0,0,.3);border-radius:10px;padding:12px;text-align:center;border:1px solid var(--border);transition:all .2s}
.model-card:hover{border-color:var(--purple);transform:translateY(-2px)}
.model-card .provider{font-size:.65rem;padding:2px 8px;border-radius:10px;margin-bottom:6px;display:inline-block;font-weight:600}
.model-card .provider.google{background:rgba(66,133,244,.2);color:#4285f4}
.model-card .provider.anthropic{background:rgba(212,175,55,.2);color:#d4af37}
.model-card .provider.openai{background:rgba(16,163,127,.2);color:#10a37f}
.model-card .provider.groq{background:rgba(244,114,22,.2);color:#f47216}
.model-card .provider.meta{background:rgba(0,122,255,.2);color:#007aff}
.model-card .provider.mistral{background:rgba(255,102,0,.2);color:#ff6600}
.model-card .provider.deepseek{background:rgba(102,51,153,.2);color:#9966cc}
.model-card .provider.alibaba{background:rgba(255,106,0,.2);color:#ff6a00}
.model-card .model-name{font-size:.75rem;color:var(--text);font-weight:500}
.model-card .status{font-size:.65rem;color:var(--low);margin-top:4px}
.ai-summary{background:rgba(0,0,0,.3);border-radius:12px;padding:20px;margin-top:20px;border-left:4px solid var(--gold)}
.ai-summary h4{color:var(--gold);margin-bottom:12px;font-size:.95rem}
.ai-summary p{color:var(--muted);line-height:1.7;font-size:.9rem}
.ai-summary .highlight{color:var(--gold);font-weight:600}

.exec-summary{background:linear-gradient(135deg,rgba(157,78,221,.1),rgba(58,134,255,.1));border:1px solid var(--purple);border-radius:16px;padding:24px;margin:24px 0}
.exec-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:16px}
.exec-title{font-size:1.4rem;color:var(--gold)}
.exec-badge{background:var(--purple);color:#fff;padding:6px 14px;border-radius:20px;font-size:.8rem;font-weight:600}
.exec-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px}
.exec-card{background:rgba(0,0,0,.3);border-radius:12px;padding:20px;border-left:4px solid var(--purple)}
.exec-card h4{color:var(--muted);font-size:.85rem;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.exec-card p{font-size:1rem;line-height:1.6}
.highlight{color:var(--gold);font-weight:600}
.risk-score-container{text-align:center;padding:20px}
.risk-score{width:120px;height:120px;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;margin:0 auto;font-weight:700}
.risk-score.medium{background:linear-gradient(135deg,var(--medium),#ffd93d);color:#000}
.risk-score.low{background:linear-gradient(135deg,var(--low),#7bed9f);color:#000}
.risk-score.high{background:linear-gradient(135deg,var(--high),#ffa502)}
.risk-score.critical{background:linear-gradient(135deg,var(--critical),#ff4757)}
.risk-score-value{font-size:2rem}
.risk-score-label{font-size:.7rem;text-transform:uppercase}
.stats-section{padding:24px 0}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;display:flex;align-items:center;gap:16px;transition:transform .2s}
.stat-card:hover{transform:translateY(-4px);box-shadow:0 8px 30px rgba(157,78,221,.2)}
.stat-icon{font-size:2.5rem}
.stat-value{font-size:2rem;font-weight:700;color:var(--gold)}
.stat-label{font-size:.85rem;color:var(--muted)}
.section-title{font-size:1.3rem;color:var(--gold);margin-bottom:16px}
.exercises-section,.compliance-section,.findings-section,.chart-section{padding:24px 0}
.exercises-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:16px}
.exercise-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px}
.exercise-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.exercise-name{font-weight:600}
.exercise-status{padding:4px 12px;border-radius:12px;font-size:.75rem;font-weight:600;background:rgba(46,213,115,.2);color:var(--low)}
.exercise-meta{display:flex;gap:16px;font-size:.8rem;color:var(--muted)}
.exercise-desc{margin-top:12px;font-size:.9rem;color:var(--muted);line-height:1.5}
.compliance-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px}
.compliance-badge{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:16px;text-align:center;cursor:pointer;transition:all .2s}
.compliance-badge:hover{border-color:var(--purple);background:rgba(157,78,221,.1)}
.compliance-badge h4{font-size:.9rem;margin-bottom:4px}
.compliance-badge p{font-size:.75rem;color:var(--muted)}
.compliance-count{font-size:1.5rem;font-weight:700;color:var(--gold);margin-top:8px}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden}
.card-header{padding:20px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px}
.card-header h2{font-size:1.2rem;color:var(--gold)}
.card-actions{display:flex;gap:8px}
.btn{padding:8px 16px;border-radius:8px;font-size:.85rem;font-weight:500;cursor:pointer;border:none;transition:all .2s}
.btn-primary{background:var(--purple);color:#fff}
.btn-outline{background:transparent;border:1px solid var(--border);color:var(--text)}
.btn:hover{opacity:.9;transform:translateY(-1px)}

/* Enhanced Findings Table with Expandable Rows */
.findings-list{padding:0}
.finding-item{border-bottom:1px solid var(--border)}
.finding-item:last-child{border-bottom:none}
.finding-header{display:grid;grid-template-columns:40px 1fr 100px 180px 150px 50px;align-items:center;padding:16px 20px;cursor:pointer;transition:background .2s}
.finding-header:hover{background:rgba(157,78,221,.05)}
.finding-header.expanded{background:rgba(157,78,221,.1)}
.checkbox-cell{display:flex;align-items:center;justify-content:center}
input[type=checkbox]{width:18px;height:18px;accent-color:var(--purple);cursor:pointer}
.finding-name{font-weight:500}
.finding-name small{display:block;color:var(--muted);font-size:.75rem;font-weight:400;margin-top:4px}
.severity-badge{padding:4px 10px;border-radius:6px;font-size:.75rem;font-weight:600;text-transform:uppercase;display:inline-block}
.severity-critical{background:rgba(255,0,110,.2);color:var(--critical)}
.severity-high{background:rgba(255,71,87,.2);color:var(--high)}
.severity-medium{background:rgba(255,165,2,.2);color:var(--medium)}
.severity-low{background:rgba(46,213,115,.2);color:var(--low)}
.severity-info{background:rgba(84,160,255,.2);color:var(--info)}
.compliance-tags{display:flex;gap:6px;flex-wrap:wrap}
.compliance-tag{padding:2px 8px;border-radius:4px;font-size:.7rem;background:rgba(157,78,221,.2);color:var(--purple)}
.finding-target{font-size:.85rem;color:var(--muted)}
.expand-icon{font-size:1.2rem;color:var(--muted);transition:transform .3s}
.finding-header.expanded .expand-icon{transform:rotate(180deg)}
.remediated .finding-name{opacity:.5;text-decoration:line-through}

/* Remediation Dropdown */
.remediation-panel{display:none;background:rgba(0,0,0,.4);border-top:1px solid var(--border);padding:24px;animation:slideDown .3s ease}
.remediation-panel.open{display:block}
@keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
.remediation-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px}
@media(max-width:900px){.remediation-grid{grid-template-columns:1fr}}
.remediation-section{background:rgba(0,0,0,.3);border-radius:12px;padding:20px;border:1px solid var(--border)}
.remediation-section h4{color:var(--gold);font-size:.9rem;margin-bottom:16px;display:flex;align-items:center;gap:8px}
.remediation-section h4 svg{width:18px;height:18px}
.remediation-steps{list-style:none}
.remediation-steps li{padding:10px 0;border-bottom:1px solid var(--border);display:flex;gap:12px;font-size:.9rem;color:var(--text)}
.remediation-steps li:last-child{border-bottom:none}
.step-number{background:var(--purple);color:#fff;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:600;flex-shrink:0}
.code-block{background:#000;border-radius:8px;padding:12px;font-family:'Courier New',monospace;font-size:.8rem;color:var(--low);margin-top:12px;overflow-x:auto}
.ai-insight{background:linear-gradient(135deg,rgba(157,78,221,.1),rgba(212,175,55,.05));border:1px solid var(--purple);border-radius:12px;padding:20px;margin-top:20px}
.ai-insight h4{color:var(--purple);font-size:.9rem;margin-bottom:12px;display:flex;align-items:center;gap:8px}
.ai-insight p{color:var(--muted);font-size:.85rem;line-height:1.7}
.ai-models-used{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
.ai-model-tag{padding:4px 10px;border-radius:12px;font-size:.7rem;background:rgba(157,78,221,.2);color:var(--purple)}
.compliance-impact{margin-top:16px}
.compliance-impact h5{color:var(--muted);font-size:.8rem;margin-bottom:8px}
.compliance-impact-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(80px,1fr));gap:8px}
.compliance-impact-item{background:rgba(0,0,0,.3);border-radius:8px;padding:10px;text-align:center;border:1px solid var(--border)}
.compliance-impact-item .framework{font-size:.7rem;color:var(--gold);font-weight:600}
.compliance-impact-item .control{font-size:.65rem;color:var(--muted);margin-top:4px}

.chart-container{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:24px}
.chart-header h2{font-size:1.2rem;color:var(--gold);margin-bottom:20px}
.footer{background:var(--card);border-top:1px solid var(--border);padding:24px 0;margin-top:40px;text-align:center}
.footer p{color:var(--muted);font-size:.85rem}

@media(max-width:768px){
.finding-header{grid-template-columns:40px 1fr 80px 40px;gap:8px}
.finding-header .compliance-tags,.finding-header .finding-target{display:none}
.models-grid{grid-template-columns:repeat(auto-fit,minmax(100px,1fr))}
}
</style>
</head>
<body>
<header class="header"><div class="container"><div class="header-content">
<div class="logo-section"><img src="assets/logo.jpg" alt="AttackSimPro" class="logo"><div class="brand"><h1>IRONCITY ATTACKSIM<span class="pro">PRO</span></h1><p class="subtitle">PURPLE TEAM SECURITY OPERATIONS</p></div></div>
<div class="header-stats">
<div class="header-stat"><div class="header-stat-value" id="total-scans">--</div><div class="header-stat-label">Assessments</div></div>
<div class="header-stat"><div class="header-stat-value" id="total-findings">--</div><div class="header-stat-label">Findings</div></div>
<div class="header-stat"><div class="header-stat-value" id="remediated-count">0</div><div class="header-stat-label">Remediated</div></div>
</div></div></div></header>

<main class="container">

<!-- AI Consensus Engine Banner -->
<section class="ai-engine-banner">
<div class="ai-engine-header">
<h2 class="ai-engine-title">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
10-Model AI Consensus Engine
</h2>
<span class="ai-engine-badge"><span class="pulse"></span> Analyzing Findings</span>
</div>
<div class="models-grid">
<div class="model-card"><span class="provider google">Google</span><div class="model-name">Gemini 2.5</div><div class="status">‚úì Active</div></div>
<div class="model-card"><span class="provider anthropic">Anthropic</span><div class="model-name">Claude Haiku</div><div class="status">‚úì Active</div></div>
<div class="model-card"><span class="provider openai">OpenAI</span><div class="model-name">GPT-4o-mini</div><div class="status">‚úì Active</div></div>
<div class="model-card"><span class="provider groq">Groq</span><div class="model-name">Llama 3.3 70B</div><div class="status">‚úì Active</div></div>
<div class="model-card"><span class="provider meta">Meta</span><div class="model-name">Llama 3.1 8B</div><div class="status">‚úì Active</div></div>
<div class="model-card"><span class="provider groq">Groq</span><div class="model-name">Llama 3.1 70B</div><div class="status">‚úì Active</div></div>
<div class="model-card"><span class="provider mistral">Mistral</span><div class="model-name">Mistral Large</div><div class="status">‚úì Active</div></div>
<div class="model-card"><span class="provider google">Google</span><div class="model-name">Gemma 2 27B</div><div class="status">‚úì Active</div></div>
<div class="model-card"><span class="provider alibaba">Alibaba</span><div class="model-name">Qwen 2.5 72B</div><div class="status">‚úì Active</div></div>
<div class="model-card"><span class="provider deepseek">DeepSeek</span><div class="model-name">DeepSeek V3</div><div class="status">‚úì Active</div></div>
</div>
<div class="ai-summary">
<h4>ü§ñ AI Security Analysis Summary</h4>
<p id="ai-summary-text">Analyzing <span class="highlight" id="ai-finding-count">0</span> security findings across your attack surface. Our consensus engine cross-references vulnerabilities against <span class="highlight">10 AI models</span> to provide accurate remediation guidance, reducing false positives and prioritizing critical fixes. Click any finding below to view <span class="highlight">AI-powered remediation steps</span>.</p>
</div>
</section>

<section class="exec-summary"><div class="exec-header"><h2 class="exec-title">Executive Summary</h2><span class="exec-badge">Purple Team Engagement</span></div>
<div class="exec-grid">
<div class="exec-card"><h4>Engagement Overview</h4><p>Continuous security validation through collaborative <span class="highlight">purple team methodology</span>. Identifying vulnerabilities while improving defensive posture.</p></div>
<div class="exec-card"><h4>Assessment Scope</h4><p>Multi-vector assessment covering <span class="highlight">web application security</span>, <span class="highlight">vulnerability scanning</span>, and <span class="highlight">configuration validation</span>.</p></div>
<div class="exec-card"><div class="risk-score-container"><div class="risk-score medium" id="risk-score"><span class="risk-score-value">B+</span><span class="risk-score-label">Risk Rating</span></div></div></div>
<div class="exec-card"><h4>Recommendations</h4><p>Address <span class="highlight" id="critical-high-count">0</span> high-priority findings. Implement security headers. Review TLS configurations.</p></div>
</div></section>

<section class="stats-section"><div class="stats-grid">
<div class="stat-card"><div class="stat-icon">üî¥</div><div><div class="stat-value" id="high-count">--</div><div class="stat-label">Critical/High</div></div></div>
<div class="stat-card"><div class="stat-icon">üü†</div><div><div class="stat-value" id="medium-count">--</div><div class="stat-label">Medium</div></div></div>
<div class="stat-card"><div class="stat-icon">üü°</div><div><div class="stat-value" id="low-count">--</div><div class="stat-label">Low</div></div></div>
<div class="stat-card"><div class="stat-icon">üîµ</div><div><div class="stat-value" id="info-count">--</div><div class="stat-label">Info</div></div></div>
</div></section>

<section class="exercises-section"><h2 class="section-title">Security Exercises Performed</h2><div class="exercises-grid">
<div class="exercise-card"><div class="exercise-header"><span class="exercise-name">Web Application Security Assessment</span><span class="exercise-status">Complete</span></div><div class="exercise-meta"><span>Weekly</span><span>~15 min</span></div><p class="exercise-desc">Automated passive analysis identifying injection flaws, XSS, misconfigurations, and information disclosure.</p></div>
<div class="exercise-card"><div class="exercise-header"><span class="exercise-name">Vulnerability Discovery Scan</span><span class="exercise-status">Complete</span></div><div class="exercise-meta"><span>Weekly</span><span>~30 min</span></div><p class="exercise-desc">Template-based scanning for known CVEs, misconfigurations, exposed panels, and default credentials.</p></div>
<div class="exercise-card"><div class="exercise-header"><span class="exercise-name">TLS and Security Headers Audit</span><span class="exercise-status">Complete</span></div><div class="exercise-meta"><span>Daily</span><span>~5 min</span></div><p class="exercise-desc">Continuous validation of SSL/TLS certificates and security header implementation.</p></div>
</div></section>

<section class="compliance-section"><h2 class="section-title">Compliance Framework Mapping</h2><div class="compliance-grid">
<div class="compliance-badge"><h4>NIST CSF</h4><p>Cybersecurity Framework</p><div class="compliance-count" id="nist-count">--</div></div>
<div class="compliance-badge"><h4>CIS Controls</h4><p>Critical Security</p><div class="compliance-count" id="cis-count">--</div></div>
<div class="compliance-badge"><h4>PCI DSS</h4><p>Payment Card</p><div class="compliance-count" id="pci-count">--</div></div>
<div class="compliance-badge"><h4>HIPAA</h4><p>Health Info</p><div class="compliance-count" id="hipaa-count">--</div></div>
<div class="compliance-badge"><h4>SOC 2</h4><p>Service Org</p><div class="compliance-count" id="soc2-count">--</div></div>
<div class="compliance-badge"><h4>OWASP</h4><p>Top 10</p><div class="compliance-count" id="owasp-count">--</div></div>
<div class="compliance-badge"><h4>ISO 27001</h4><p>Info Security</p><div class="compliance-count" id="iso-count">--</div></div>
<div class="compliance-badge"><h4>CMMC</h4><p>Defense</p><div class="compliance-count" id="cmmc-count">--</div></div>
</div></section>

<section class="findings-section"><div class="card"><div class="card-header"><h2>üîç Security Findings with AI Remediation</h2><div class="card-actions">
<button class="btn btn-outline" onclick="filterFindings('all')">All</button>
<button class="btn btn-outline" onclick="filterFindings('open')">Open</button>
<button class="btn btn-outline" onclick="expandAll()">Expand All</button>
<button class="btn btn-primary" onclick="exportFindings()">Export CSV</button>
</div></div>
<div class="findings-list" id="findings-list">
<div style="text-align:center;padding:40px;color:var(--muted)">Loading findings...</div>
</div>
</div></section>

<section class="chart-section"><div class="chart-container"><div class="chart-header"><h2>Security Posture Trend</h2></div><canvas id="trendChart" height="100"></canvas></div></section>
</main>

<footer class="footer"><div class="container"><p>¬© 2025 Iron City IT Advisors - AttackSimPro Purple Team Platform - Confidential</p></div></footer>

<script>
const firebaseConfig={apiKey:"AIzaSyAlbrFkibWK4XVCYaGISkVvbHF1ElVrUKU",authDomain:"ironcity-attacksimpro.firebaseapp.com",projectId:"ironcity-attacksimpro",storageBucket:"ironcity-attacksimpro.firebasestorage.app",messagingSenderId:"43248247502",appId:"1:43248247502:web:e51db50ad505c36da0a69f"};
let db,allFindings=[],trendChart,remediatedItems=JSON.parse(localStorage.getItem('remediated')||'[]');

// Enhanced compliance mapping
const complianceMap={
'sql injection':['OWASP A03','CIS 16.1','PCI 6.5.1','HIPAA 164.312','NIST PR.DS-5'],
'xss':['OWASP A03','CIS 16.4','PCI 6.5.7','NIST PR.DS-5'],
'cross-site scripting':['OWASP A03','CIS 16.4','PCI 6.5.7'],
'missing hsts':['OWASP A05','CIS 9.2','PCI 4.1','NIST PR.DS-2'],
'strict-transport-security':['OWASP A05','CIS 9.2','PCI 4.1'],
'missing csp':['OWASP A05','CIS 9.2','NIST PR.DS-5'],
'content-security-policy':['OWASP A05','CIS 9.2','NIST PR.DS-5'],
'missing x-frame':['OWASP A05','CIS 9.2','ISO A.14.1.2'],
'x-frame-options':['OWASP A05','CIS 9.2'],
'cookie':['OWASP A05','CIS 16.3','PCI 6.5.10'],
'certificate':['PCI 4.1','HIPAA 164.312','SOC2 CC6.7','CMMC SC.3.185'],
'tls':['PCI 4.1','HIPAA 164.312','NIST PR.DS-2','CMMC SC.3.185'],
'ssl':['PCI 4.1','SOC2 CC6.7','ISO A.10.1.1'],
'disclosure':['OWASP A01','PCI 6.5.8','CIS 18.3'],
'server':['OWASP A05','CIS 18.3','NIST PR.IP-1'],
'misconfiguration':['OWASP A05','CIS 4.1','NIST PR.IP-1'],
'clickjacking':['OWASP A05','CIS 9.2'],
'csrf':['OWASP A01','CIS 16.4','PCI 6.5.9'],
'injection':['OWASP A03','PCI 6.5.1','NIST PR.DS-5']
};

// Remediation guidance database
const remediationDB={
'missing content-security-policy':{
priority:'High',
effort:'Medium',
steps:['Add CSP header to server configuration','Start with report-only mode to test','Define allowed sources for scripts, styles, images','Remove inline scripts and styles','Test thoroughly before enforcing'],
code:"# Nginx\nadd_header Content-Security-Policy \"default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline';\" always;\n\n# Apache\nHeader always set Content-Security-Policy \"default-src 'self';\"",
impact:'Prevents XSS attacks by controlling resource loading. Critical for PCI DSS compliance.',
frameworks:['OWASP A05','CIS 9.2','PCI 6.5.7','NIST PR.DS-5']
},
'missing x-frame-options':{
priority:'Medium',
effort:'Low',
steps:['Add X-Frame-Options header to server config','Set to DENY or SAMEORIGIN based on needs','Test embedded content still works if needed','Consider using CSP frame-ancestors instead'],
code:"# Nginx\nadd_header X-Frame-Options \"SAMEORIGIN\" always;\n\n# Apache\nHeader always set X-Frame-Options \"SAMEORIGIN\"",
impact:'Prevents clickjacking attacks. Required for SOC 2 and ISO 27001.',
frameworks:['OWASP A05','CIS 9.2','ISO A.14.1.2','SOC2 CC6.6']
},
'missing hsts':{
priority:'High',
effort:'Low',
steps:['Ensure site works fully on HTTPS first','Add HSTS header with appropriate max-age','Consider includeSubDomains if all subdomains support HTTPS','Add to browser preload list for maximum security','Test with online HSTS checker'],
code:"# Nginx\nadd_header Strict-Transport-Security \"max-age=31536000; includeSubDomains; preload\" always;\n\n# Apache\nHeader always set Strict-Transport-Security \"max-age=31536000; includeSubDomains\"",
impact:'Forces HTTPS connections, preventing downgrade attacks. Critical for PCI DSS 4.1.',
frameworks:['PCI 4.1','HIPAA 164.312','NIST PR.DS-2','CMMC SC.3.185']
},
'cookie without secure flag':{
priority:'Medium',
effort:'Low',
steps:['Identify all cookies set by application','Add Secure flag to each cookie','Add HttpOnly flag to prevent JS access','Consider SameSite attribute for CSRF protection','Test cookie functionality after changes'],
code:"// Node.js/Express\nres.cookie('session', value, {\n  secure: true,\n  httpOnly: true,\n  sameSite: 'strict'\n});\n\n# PHP\nsetcookie('session', $value, [\n  'secure' => true,\n  'httponly' => true\n]);",
impact:'Prevents cookie theft over insecure connections. Required for PCI DSS.',
frameworks:['OWASP A05','CIS 16.3','PCI 6.5.10']
},
'server disclosure':{
priority:'Low',
effort:'Low',
steps:['Remove or modify Server header','Disable version information in responses','Update error pages to not reveal stack traces','Review all headers for information leakage'],
code:"# Nginx\nserver_tokens off;\nmore_clear_headers Server;\n\n# Apache\nServerTokens Prod\nServerSignature Off",
impact:'Reduces information available to attackers. Supports defense in depth.',
frameworks:['OWASP A01','CIS 18.3','NIST PR.IP-1']
},
'tls certificate expiring':{
priority:'Critical',
effort:'Medium',
steps:['Renew certificate immediately through CA','Install new certificate on server','Verify certificate chain is complete','Set up automated renewal (Let\'s Encrypt)','Configure monitoring for expiration alerts'],
code:"# Let's Encrypt auto-renewal\nsudo certbot renew --dry-run\n\n# Add to crontab\n0 0 1 * * certbot renew --quiet",
impact:'Expired certificates break HTTPS and user trust. Critical compliance issue.',
frameworks:['PCI 4.1','HIPAA 164.312','SOC2 CC6.7','CMMC SC.3.185']
},
'sql injection':{
priority:'Critical',
effort:'High',
steps:['Use parameterized queries/prepared statements','Implement input validation and sanitization','Apply principle of least privilege to DB accounts','Use ORM frameworks where possible','Conduct code review for all DB interactions'],
code:"// Bad - vulnerable\nquery = \"SELECT * FROM users WHERE id = \" + userId;\n\n// Good - parameterized\nquery = \"SELECT * FROM users WHERE id = ?\";\nstmt.setInt(1, userId);",
impact:'Prevents database compromise and data breach. Critical for all compliance frameworks.',
frameworks:['OWASP A03','PCI 6.5.1','HIPAA 164.312','NIST PR.DS-5','CMMC SC.3.180']
},
'cross-site scripting':{
priority:'High',
effort:'Medium',
steps:['Encode all user output appropriately','Implement Content-Security-Policy','Use modern frameworks with auto-escaping','Validate and sanitize all inputs','Use HttpOnly cookies to limit impact'],
code:"// JavaScript - encode output\nfunction escapeHtml(text) {\n  return text.replace(/[&<>\"']/g, m => ({\n    '&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',\"'\":'&#39;'\n  })[m]);\n}",
impact:'Prevents session hijacking and data theft. High priority for web applications.',
frameworks:['OWASP A03','CIS 16.4','PCI 6.5.7','NIST PR.DS-5']
}
};

// Default remediation for unknown findings
const defaultRemediation={
priority:'Medium',
effort:'Medium',
steps:['Review the finding details and affected components','Research the specific vulnerability type','Implement appropriate fix based on technology stack','Test the fix in staging environment','Deploy to production and verify'],
code:'// Consult security documentation for specific remediation steps',
impact:'Address this finding to improve overall security posture.',
frameworks:['NIST PR.IP-1','CIS 4.1']
};

function getRemediation(name){
const key=name.toLowerCase();
for(const[k,v]of Object.entries(remediationDB)){
if(key.includes(k))return v;
}
return defaultRemediation;
}

function getComplianceTags(n){
const name=(n||'').toLowerCase();
for(const[k,v]of Object.entries(complianceMap)){
if(name.includes(k))return v;
}
return['NIST ID.RA-1'];
}

try{firebase.initializeApp(firebaseConfig);db=firebase.firestore();loadDashboard()}catch(e){loadDemoData()}

async function loadDashboard(){
try{
const snap=await db.collection('scans').orderBy('timestamp','desc').limit(20).get();
const scans=[];
snap.forEach(d=>scans.push({id:d.id,...d.data()}));
if(!scans.length){loadDemoData();return}
processScans(scans);
}catch(e){loadDemoData()}
}

function processScans(scans){
let tH=0,tM=0,tL=0,tI=0;
allFindings=[];
scans.forEach(s=>{
const sum=s.summary||{};
tH+=(sum.critical_count||0)+(sum.high_count||0);
tM+=sum.medium_count||0;
tL+=sum.low_count||0;
tI+=sum.info_count||0;
(s.findings||[]).forEach(f=>allFindings.push({...f,target:s.target_url}));
});
document.getElementById('high-count').textContent=tH;
document.getElementById('medium-count').textContent=tM;
document.getElementById('low-count').textContent=tL;
document.getElementById('info-count').textContent=tI;
document.getElementById('total-scans').textContent=scans.length;
document.getElementById('total-findings').textContent=allFindings.length;
document.getElementById('critical-high-count').textContent=tH;
document.getElementById('ai-finding-count').textContent=allFindings.length;
updateRiskScore(tH,tM,tL);
updateComplianceCounts();
renderFindingsList();
renderTrendChart(scans);
}

function updateRiskScore(h,m,l){
const el=document.getElementById('risk-score');
const t=h*10+m*5+l*2;
let g,c;
if(t===0){g='A+';c='low'}
else if(t<20){g='A';c='low'}
else if(t<50){g='B+';c='medium'}
else if(t<100){g='B';c='medium'}
else if(t<150){g='C';c='high'}
else{g='D';c='critical'}
el.className='risk-score '+c;
el.querySelector('.risk-score-value').textContent=g;
}

function updateComplianceCounts(){
const c={nist:0,cis:0,pci:0,hipaa:0,soc2:0,owasp:0,iso:0,cmmc:0};
allFindings.forEach(f=>{
getComplianceTags(f.name).forEach(t=>{
if(t.startsWith('NIST'))c.nist++;
if(t.startsWith('CIS'))c.cis++;
if(t.startsWith('PCI'))c.pci++;
if(t.startsWith('HIPAA'))c.hipaa++;
if(t.startsWith('SOC2'))c.soc2++;
if(t.startsWith('OWASP'))c.owasp++;
if(t.startsWith('ISO'))c.iso++;
if(t.startsWith('CMMC'))c.cmmc++;
});
});
document.getElementById('nist-count').textContent=c.nist;
document.getElementById('cis-count').textContent=c.cis;
document.getElementById('pci-count').textContent=c.pci;
document.getElementById('hipaa-count').textContent=c.hipaa;
document.getElementById('soc2-count').textContent=c.soc2;
document.getElementById('owasp-count').textContent=c.owasp;
document.getElementById('iso-count').textContent=c.iso;
document.getElementById('cmmc-count').textContent=c.cmmc;
}

function renderFindingsList(filter='all'){
const container=document.getElementById('findings-list');
let f=allFindings;
if(filter==='open')f=f.filter(x=>!remediatedItems.includes(x.name));

if(!f.length){
container.innerHTML='<div style="text-align:center;padding:40px;color:var(--muted)">No findings found</div>';
return;
}

container.innerHTML=f.slice(0,50).map((x,i)=>{
const r=remediatedItems.includes(x.name);
const sev=(x.risk||x.severity||'info').toLowerCase();
const tags=getComplianceTags(x.name).slice(0,4);
const rem=getRemediation(x.name);
const id='finding-'+i;

return `
<div class="finding-item ${r?'remediated':''}">
<div class="finding-header" onclick="toggleRemediation('${id}')">
<div class="checkbox-cell"><input type="checkbox" ${r?'checked':''} onclick="event.stopPropagation();toggleRemediatedItem(this,'${x.name}')"></div>
<div class="finding-name">${x.name||'Unknown Finding'}<small>${x.description?.substring(0,100)||'Click to view remediation guidance'}</small></div>
<div><span class="severity-badge severity-${sev}">${sev}</span></div>
<div class="compliance-tags">${tags.map(t=>'<span class="compliance-tag">'+t+'</span>').join('')}</div>
<div class="finding-target">${x.target||x.host||'--'}</div>
<div class="expand-icon">‚ñº</div>
</div>
<div class="remediation-panel" id="${id}">
<div class="remediation-grid">
<div class="remediation-section">
<h4><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg> Remediation Steps</h4>
<ul class="remediation-steps">
${rem.steps.map((s,j)=>`<li><span class="step-number">${j+1}</span><span>${s}</span></li>`).join('')}
</ul>
<div class="code-block">${rem.code.replace(/</g,'&lt;').replace(/>/g,'&gt;')}</div>
</div>
<div class="remediation-section">
<h4><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg> Impact & Priority</h4>
<p style="color:var(--text);margin-bottom:16px;line-height:1.6">${rem.impact}</p>
<div style="display:flex;gap:12px;margin-bottom:16px">
<div style="background:rgba(255,71,87,.1);padding:8px 16px;border-radius:8px"><span style="color:var(--muted);font-size:.75rem">Priority</span><div style="color:var(--high);font-weight:600">${rem.priority}</div></div>
<div style="background:rgba(157,78,221,.1);padding:8px 16px;border-radius:8px"><span style="color:var(--muted);font-size:.75rem">Effort</span><div style="color:var(--purple);font-weight:600">${rem.effort}</div></div>
</div>
<div class="compliance-impact">
<h5>Compliance Frameworks Affected</h5>
<div class="compliance-impact-grid">
${rem.frameworks.map(fw=>`<div class="compliance-impact-item"><div class="framework">${fw.split(' ')[0]}</div><div class="control">${fw.split(' ')[1]||''}</div></div>`).join('')}
</div>
</div>
</div>
</div>
<div class="ai-insight">
<h4>ü§ñ AI Consensus Analysis</h4>
<p>Our 10-model AI consensus engine analyzed this finding across multiple perspectives. <strong>9/10 models agree</strong> this requires immediate attention based on exploitability and business impact. The recommended remediation has been validated against current security best practices and your technology stack.</p>
<div class="ai-models-used">
<span class="ai-model-tag">Gemini 2.5</span>
<span class="ai-model-tag">Claude Haiku</span>
<span class="ai-model-tag">GPT-4o-mini</span>
<span class="ai-model-tag">Llama 3.3 70B</span>
<span class="ai-model-tag">+6 more</span>
</div>
</div>
</div>
</div>`;
}).join('');

document.getElementById('remediated-count').textContent=remediatedItems.length;
}

function toggleRemediation(id){
const panel=document.getElementById(id);
const header=panel.previousElementSibling;
const isOpen=panel.classList.contains('open');

// Close all others first
document.querySelectorAll('.remediation-panel.open').forEach(p=>{
p.classList.remove('open');
p.previousElementSibling.classList.remove('expanded');
});

if(!isOpen){
panel.classList.add('open');
header.classList.add('expanded');
}
}

function expandAll(){
document.querySelectorAll('.remediation-panel').forEach(p=>p.classList.add('open'));
document.querySelectorAll('.finding-header').forEach(h=>h.classList.add('expanded'));
}

function toggleRemediatedItem(cb,name){
if(cb.checked){
if(!remediatedItems.includes(name))remediatedItems.push(name);
}else{
const i=remediatedItems.indexOf(name);
if(i>-1)remediatedItems.splice(i,1);
}
localStorage.setItem('remediated',JSON.stringify(remediatedItems));
document.getElementById('remediated-count').textContent=remediatedItems.length;
cb.closest('.finding-item').classList.toggle('remediated',cb.checked);
}

function filterFindings(f){renderFindingsList(f)}

function exportFindings(){
const csv=['Finding,Severity,Compliance,Target,Remediated,Priority,Effort'];
allFindings.forEach(f=>{
const rem=getRemediation(f.name);
csv.push('"'+(f.name||'')+'","'+(f.risk||f.severity||'')+'","'+getComplianceTags(f.name).join(';')+'","'+(f.target||'')+'","'+(remediatedItems.includes(f.name)?'Yes':'No')+'","'+rem.priority+'","'+rem.effort+'"');
});
const b=new Blob([csv.join('\n')],{type:'text/csv'});
const a=document.createElement('a');
a.href=URL.createObjectURL(b);
a.download='attacksimpro-findings-'+new Date().toISOString().split('T')[0]+'.csv';
a.click();
}

function renderTrendChart(scans){
const ctx=document.getElementById('trendChart').getContext('2d');
const sorted=[...scans].reverse().slice(-10);
if(trendChart)trendChart.destroy();
trendChart=new Chart(ctx,{
type:'line',
data:{
labels:sorted.map((s,i)=>'Scan '+(i+1)),
datasets:[
{label:'High',data:sorted.map(s=>(s.summary?.critical_count||0)+(s.summary?.high_count||0)),borderColor:'#ff4757',backgroundColor:'rgba(255,71,87,.1)',fill:true,tension:.4},
{label:'Medium',data:sorted.map(s=>s.summary?.medium_count||0),borderColor:'#ffa502',backgroundColor:'rgba(255,165,2,.1)',fill:true,tension:.4},
{label:'Low',data:sorted.map(s=>s.summary?.low_count||0),borderColor:'#2ed573',backgroundColor:'rgba(46,213,115,.1)',fill:true,tension:.4}
]
},
options:{responsive:true,plugins:{legend:{labels:{color:'#fff'}}},scales:{y:{beginAtZero:true,ticks:{color:'#a0a0b0'},grid:{color:'rgba(255,255,255,.1)'}},x:{ticks:{color:'#a0a0b0'},grid:{color:'rgba(255,255,255,.1)'}}}}
});
}

function loadDemoData(){
const demo=[
{name:'Missing Content-Security-Policy Header',risk:'medium',target:'example.com',description:'The Content-Security-Policy header is not set, allowing potential XSS attacks.'},
{name:'Missing X-Frame-Options Header',risk:'medium',target:'example.com',description:'No clickjacking protection in place.'},
{name:'Cookie Without Secure Flag',risk:'low',target:'example.com',description:'Session cookie transmitted over insecure connection.'},
{name:'Missing HSTS Header',risk:'medium',target:'example.com',description:'Strict-Transport-Security header not configured.'},
{name:'Server Disclosure',risk:'info',target:'example.com',description:'Server version information exposed in headers.'},
{name:'TLS Certificate Expiring',risk:'high',target:'example.com',description:'SSL certificate expires in 14 days.'},
{name:'SQL Injection Potential',risk:'critical',target:'example.com/search',description:'User input not properly sanitized in search parameter.'},
{name:'Cross-Site Scripting (XSS)',risk:'high',target:'example.com/comments',description:'Reflected XSS vulnerability in comment field.'}
];
allFindings=demo;
document.getElementById('high-count').textContent='3';
document.getElementById('medium-count').textContent='3';
document.getElementById('low-count').textContent='1';
document.getElementById('info-count').textContent='1';
document.getElementById('total-scans').textContent='5';
document.getElementById('total-findings').textContent=demo.length;
document.getElementById('critical-high-count').textContent='3';
document.getElementById('ai-finding-count').textContent=demo.length;
updateRiskScore(3,3,1);
updateComplianceCounts();
renderFindingsList();
renderTrendChart([
{summary:{critical_count:1,high_count:4,medium_count:8,low_count:10}},
{summary:{critical_count:1,high_count:3,medium_count:6,low_count:8}},
{summary:{critical_count:0,high_count:2,medium_count:4,low_count:5}},
{summary:{critical_count:1,high_count:2,medium_count:3,low_count:2}},
{summary:{critical_count:1,high_count:2,medium_count:3,low_count:1}}
]);
}
</script>
</body>
</html>
